    <div class="container mt-4" *ngIf="consultorio">
      <div class="card modern-card">
        <!-- HEADER MODERNO -->
        <div class="card-header">
          <div class="header-content">
            <div class="header-icon">
              <i class="fas fa-door-open"></i>
            </div>
            <div class="header-text">
              <h1>{{ esNuevo ? 'Nuevo Consultorio' : 'Consultorio #' + consultorio.numero }}</h1>
              <p>{{ esNuevo ? 'Configure un nuevo consultorio' : consultorio.nombre }}</p>
            </div>
          </div>
        </div>

        <!-- BODY DEL CARD -->
        <div class="card-body">
          <!-- MODO VISTA -->
          <div *ngIf="!modoEdicion">
            <div class="info-grid">
              <div class="info-item">
                <div class="info-label">
                  <span class="info-icon" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">üî¢</span>
                  N√∫mero
                </div>
                <div class="info-value">
                  {{ consultorio.numero }}
                </div>
              </div>

              <div class="info-item">
                <div class="info-label">
                  <span class="info-icon" style="background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);">üè∑Ô∏è</span>
                  Nombre
                </div>
                <div class="info-value">
                  {{ consultorio.nombre }}
                </div>
              </div>

              <div class="info-item">
                <div class="info-label">
                  <span class="info-icon" style="background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);">üè•</span>
                  Centro de Atenci√≥n
                </div>
                <div class="info-value">
                  {{ consultorio.centroAtencion?.nombre || 'Sin centro asignado' }}
                </div>
              </div>

              <!-- Horarios de Atenci√≥n -->
              <div class="info-item col-md-12">
                <div class="info-label">
                  <span class="info-icon" style="background: linear-gradient(135deg, #20c997 0%, #17a2b8 100%);">üïê</span>
                  Horarios de Atenci√≥n
                </div>
                <div class="info-value">
                  <!-- Mostrar horarios espec√≠ficos si existen y est√°n configurados -->
                  <div *ngIf="tieneHorariosEspecificos(); else generalSchedule">
                    <div class="schedule-type-badge mb-2">
                      <span class="badge bg-primary">üìÖ Horarios Espec√≠ficos por D√≠a</span>
                    </div>
                    <div class="schedule-display">
                      <div *ngFor="let horario of consultorio.horariosSemanales" class="schedule-day" 
                           [ngClass]="{'inactive-day': !horario.activo}">
                        <span class="day-name">{{ horario.diaSemana }}</span>
                        <span class="day-hours" *ngIf="horario.activo">
                          {{ horario.horaApertura }} - {{ horario.horaCierre }}
                        </span>
                        <span class="day-hours inactive" *ngIf="!horario.activo">Cerrado</span>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Mostrar horarios generales como fallback -->
                  <ng-template #generalSchedule>
                    <div class="schedule-type-badge mb-2">
                      <span class="badge bg-success">‚è∞ Horario General</span>
                    </div>
                    <div class="default-hours" *ngIf="consultorio.horaAperturaDefault && consultorio.horaCierreDefault">
                      <strong>Todos los d√≠as:</strong> {{ consultorio.horaAperturaDefault }} - {{ consultorio.horaCierreDefault }}
                    </div>
                    <span class="text-muted" *ngIf="!consultorio.horaAperturaDefault">Sin horarios configurados</span>
                  </ng-template>
                </div>
              </div>
            </div>
          </div>

          <!-- MODO EDICI√ìN -->
          <form *ngIf="modoEdicion" #form="ngForm" (ngSubmit)="save()">
            <div class="row">
              <!-- N√∫mero -->
              <div class="col-md-6">
                <div class="form-group-modern">
                  <label class="form-label-modern">
                    <span class="form-icon" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">üî¢</span>
                    N√∫mero del Consultorio
                  </label>
                  <input 
                    type="number" 
                    name="numero" 
                    required 
                    placeholder="N√∫mero del consultorio" 
                    class="form-control form-control-modern"
                    [(ngModel)]="consultorio.numero" 
                    #numero="ngModel" 
                    min="1"
                  />
                  <div *ngIf="numero.invalid && (numero.dirty || numero.touched)" class="form-help text-danger">
                    <div *ngIf="numero.errors?.['required']">
                      El n√∫mero del consultorio es requerido
                    </div>
                    <div *ngIf="numero.errors?.['min']">
                      El n√∫mero debe ser mayor o igual a 1
                    </div>
                  </div>
                </div>
              </div>

              <!-- Nombre -->
              <div class="col-md-6">
                <div class="form-group-modern">
                  <label class="form-label-modern">
                    <span class="form-icon" style="background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);">üè∑Ô∏è</span>
                    Nombre del Consultorio
                  </label>
                  <input 
                    name="nombre" 
                    required 
                    placeholder="Nombre del consultorio" 
                    class="form-control form-control-modern" 
                    [(ngModel)]="consultorio.nombre"
                    #nombre="ngModel"
                  />
                  <div *ngIf="nombre.invalid && (nombre.dirty || nombre.touched)" class="form-help text-danger">
                    <div *ngIf="nombre.errors?.['required']">
                      El nombre del consultorio es requerido
                    </div>
                  </div>
                </div>
              </div>

              <!-- Centro de Atenci√≥n -->
              <div class="col-md-12">
                <div class="form-group-modern">
                  <label class="form-label-modern">
                    <span class="form-icon" style="background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);">üè•</span>
                    Centro de Atenci√≥n
                  </label>
                  <input
                    type="text"
                    class="form-control form-control-modern"
                    name="centroSearch"
                    placeholder="Buscar centro..."
                    [(ngModel)]="centroSearch"
                    [ngbTypeahead]="searchCentros"
                    [inputFormatter]="formatCentro"
                    [resultFormatter]="formatCentro"
                    (selectItem)="onSelectCentro($event)"
                  />
                  <div class="form-help">
                    Centro de atenci√≥n al que pertenece este consultorio
                  </div>
                </div>
              </div>

              <!-- Selector de Tipo de Horario -->
              <div class="col-md-12">
                <div class="form-group-modern">
                  <label class="form-label-modern">
                    <span class="form-icon" style="background: linear-gradient(135deg, #20c997 0%, #17a2b8 100%);">üïê</span>
                    Configuraci√≥n de Horarios
                  </label>
                  <div class="schedule-type-selector">
                    <div class="form-check form-check-inline">
                      <input
                        class="form-check-input"
                        type="radio"
                        name="tipoHorario"
                        id="horarioGeneral"
                        value="general"
                        [(ngModel)]="tipoHorario"
                        (change)="onTipoHorarioChange()"
                      />
                      <label class="form-check-label" for="horarioGeneral">
                        <strong>Horario General</strong>
                        <small class="d-block text-muted">Mismo horario todos los d√≠as</small>
                      </label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input
                        class="form-check-input"
                        type="radio"
                        name="tipoHorario"
                        id="horarioEspecifico"
                        value="especifico"
                        [(ngModel)]="tipoHorario"
                        (change)="onTipoHorarioChange()"
                      />
                      <label class="form-check-label" for="horarioEspecifico">
                        <strong>Horarios Espec√≠ficos</strong>
                        <small class="d-block text-muted">Diferentes horarios por d√≠a</small>
                      </label>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Horarios por Defecto (Solo si tipo = general) -->
              <div class="col-md-12" *ngIf="tipoHorario === 'general'">
                <div class="form-group-modern">
                  <label class="form-label-modern">
                    <span class="form-icon" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">‚è∞</span>
                    Horario General
                  </label>
                  <div class="row">
                    <div class="col-md-6">
                      <label class="form-label">Hora de Apertura</label>
                      <input
                        type="time"
                        class="form-control form-control-modern"
                        name="horaAperturaDefault"
                        [(ngModel)]="consultorio.horaAperturaDefault"
                        required
                      />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Hora de Cierre</label>
                      <input
                        type="time"
                        class="form-control form-control-modern"
                        name="horaCierreDefault"
                        [(ngModel)]="consultorio.horaCierreDefault"
                        required
                      />
                    </div>
                  </div>
                  <div class="form-help">
                    Este horario se aplicar√° a todos los d√≠as de la semana.
                  </div>
                </div>
              </div>

              <!-- Horarios por D√≠a de la Semana (Solo si tipo = especifico) -->
              <div class="col-md-12" *ngIf="tipoHorario === 'especifico'">
                <div class="form-group-modern">
                  <label class="form-label-modern">
                    <span class="form-icon" style="background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%);">üìÖ</span>
                    Horarios por D√≠a de la Semana
                  </label>
                  <div class="schedule-editor">
                    <div *ngFor="let horario of consultorio.horariosSemanales; let i = index" 
                         class="schedule-day-editor">
                      <div class="day-header">
                        <div class="form-check">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            [(ngModel)]="horario.activo"
                            [name]="'activo_' + i"
                            [id]="'activo_' + i"
                          />
                          <label class="form-check-label day-label" [for]="'activo_' + i">
                            {{ horario.diaSemana }}
                          </label>
                        </div>
                      </div>
                      
                      <div class="day-times" *ngIf="horario.activo">
                        <div class="row">
                          <div class="col-md-6">
                            <input
                              type="time"
                              class="form-control form-control-sm"
                              [(ngModel)]="horario.horaApertura"
                              [name]="'apertura_' + i"
                              placeholder="Apertura"
                            />
                          </div>
                          <div class="col-md-6">
                            <input
                              type="time"
                              class="form-control form-control-sm"
                              [(ngModel)]="horario.horaCierre"
                              [name]="'cierre_' + i"
                              placeholder="Cierre"
                            />
                          </div>
                        </div>
                      </div>
                      
                      <div class="day-closed" *ngIf="!horario.activo">
                        <span class="text-muted">Cerrado</span>
                      </div>
                    </div>
                  </div>
                  <div class="form-help">
                    Configure horarios espec√≠ficos para cada d√≠a. Desmarque para d√≠as que no atiende.
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>

        <!-- FOOTER DEL CARD -->
        <div class="card-footer">
          <div class="d-flex gap-2 flex-wrap">
            <!-- Botones en modo vista -->
            <ng-container *ngIf="!modoEdicion">
              <button type="button" class="btn btn-modern btn-back" (click)="goBack()">
                ‚Üê Volver
              </button>
              <button type="button" class="btn btn-modern btn-edit" (click)="activarEdicion()">
                ‚úèÔ∏è Editar
              </button>
              <button 
                type="button" 
                class="btn btn-modern btn-delete ms-auto" 
                (click)="remove()"
                *ngIf="consultorio.id && consultorio.id !== 0"
              >
                üóëÔ∏è Eliminar
              </button>
            </ng-container>

            <!-- Botones en modo edici√≥n -->
            <ng-container *ngIf="modoEdicion">
              <button 
                type="submit" 
                class="btn btn-modern btn-save" 
                (click)="save()"
              >
                üíæ Guardar
              </button>
              <button type="button" class="btn btn-modern btn-cancel" (click)="cancelar()">
                ‚ùå Cancelar
              </button>
            </ng-container>
          </div>
        </div>
      </div>
    </div>
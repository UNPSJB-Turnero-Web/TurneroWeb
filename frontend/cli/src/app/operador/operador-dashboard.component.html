<div class="operator-dashboard">
  <!-- Floating Particles Background -->
  <div class="particles-bg">
    <div
      class="particle"
      *ngFor="let p of particles; let i = index"
      [style.left.px]="p.x"
      [style.top.px]="p.y"
      [style.animation-delay.s]="i * 0.2"
    ></div>
  </div>

  <!-- Header Section -->
  <div class="dashboard-header" *ngIf="isAuthenticated()">
    <div class="header-glow"></div>
    <div class="welcome-section">
      <div class="welcome-content">
        <div class="welcome-icon">
          <i class="fas fa-user-cog"></i>
        </div>
        <div class="welcome-text">
          <h1>¡Bienvenido/a a tu Panel de Operaciones!</h1>
          <p class="operator-info">
            <i class="fas fa-user me-2"></i>
            {{ getUserName() }}
          </p>
          <p class="operator-info">
            <i class="fas fa-envelope me-2"></i>
            {{ getUserEmail() }}
          </p>
          <p class="tagline">Gestiona las operaciones de manera eficiente</p>
        </div>
      </div>
      <div class="user-actions">
        <button class="btn-logout" (click)="logout()">
          <i class="fas fa-sign-out-alt"></i>
          <span>Cerrar Sesión</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions">
    <div class="section-background"></div>
    <div class="section-title-container">
      <h2><i class="fas fa-rocket me-3"></i>Acciones Rápidas</h2>
      <p class="section-description">
        Accede rápidamente a las funciones principales
      </p>
    </div>
    <div class="actions-grid">
      <div class="action-card action-turnos" (click)="goToTurnos()">
        <div class="card-icon">
          <i class="fas fa-calendar-alt"></i>
        </div>
        <div class="card-content">
          <h3>Administrar Turnos</h3>
          <p>Ver, agendar y gestionar turnos de pacientes</p>
        </div>
        <div class="card-arrow">
          <i class="fas fa-arrow-right"></i>
        </div>
      </div>

      <div class="action-card action-operadores" (click)="goToOperadores()">
        <div class="card-icon">
          <i class="fas fa-users-cog"></i>
        </div>
        <div class="card-content">
          <h3>Gestionar Operadores</h3>
          <p>Ver y agregar nuevos operadores</p>
        </div>
        <div class="card-arrow">
          <i class="fas fa-arrow-right"></i>
        </div>
      </div>

      <div class="action-card action-centros" (click)="goToCentros()">
        <div class="card-icon">
          <i class="fas fa-hospital"></i>
        </div>
        <div class="card-content">
          <h3>Gestionar Centros</h3>
          <p>Administrar centros médicos y establecimientos de salud</p>
        </div>
        <div class="card-arrow">
          <i class="fas fa-arrow-right"></i>
        </div>
      </div>

      <div class="action-card action-reportes" (click)="goToReportes()">
        <div class="card-icon">
          <i class="fas fa-chart-line"></i>
        </div>
        <div class="card-content">
          <h3>Ver Reportes</h3>
          <p>Analizar métricas y reportes del sistema</p>
        </div>
        <div class="card-arrow">
          <i class="fas fa-arrow-right"></i>
        </div>
      </div>

      <div class="action-card action-pacientes" (click)="goToPacientes()">
        <div class="card-icon">
          <i class="fas fa-user-injured"></i>
        </div>
        <div class="card-content">
          <h3>Gestionar Pacientes</h3>
          <p>Ver y administrar información de pacientes</p>
        </div>
        <div class="card-arrow">
          <i class="fas fa-arrow-right"></i>
        </div>
      </div>

      <div class="action-card action-nuevo-paciente" (click)="createPaciente()">
        <div class="card-icon">
          <i class="fas fa-user-plus"></i>
        </div>
        <div class="card-content">
          <h3>Crear Paciente</h3>
          <p>Registrar un nuevo paciente en el sistema</p>
        </div>
        <div class="card-arrow">
          <i class="fas fa-arrow-right"></i>
        </div>
      </div>

      <div class="action-card action-medicos" (click)="goToMedicos()">
        <div class="card-icon">
          <i class="fas fa-user-md"></i>
        </div>
        <div class="card-content">
          <h3>Gestionar Médicos</h3>
          <p>Ver y administrar información de médicos</p>
        </div>
        <div class="card-arrow">
          <i class="fas fa-arrow-right"></i>
        </div>
      </div>

      <div class="action-card action-nuevo-medico" (click)="createMedico()">
        <div class="card-icon">
          <i class="fas fa-user-plus"></i>
        </div>
        <div class="card-content">
          <h3>Crear Médico</h3>
          <p>Registrar un nuevo médico en el sistema</p>
        </div>
        <div class="card-arrow">
          <i class="fas fa-arrow-right"></i>
        </div>
      </div>

      <div
        class="action-card action-notifications"
        (click)="viewNotifications()"
      >
        <div class="card-icon">
          <i class="fas fa-bell"></i>
        </div>
        <div class="card-content">
          <h3>Notificaciones</h3>
          <p>Ver mensajes y alertas del sistema</p>
        </div>
        <div class="notification-badge" *ngIf="contadorNotificaciones > 0">
          <span>{{ contadorNotificaciones }}</span>
          <div class="notification-pulse"></div>
        </div>
        <div class="card-arrow">
          <i class="fas fa-arrow-right"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Turnos Gestionados -->
  <div class="managed-appointments">
    <div class="appointments-background"></div>
    <div class="section-header">
      <div class="section-title">
        <div class="title-icon">
          <i class="fas fa-calendar-check"></i>
        </div>
        <div class="title-content">
          <h2>Turnos Gestionados</h2>
          <p class="section-subtitle">Administra los turnos de los pacientes</p>
        </div>
      </div>
      <button class="btn-schedule-appointment" (click)="scheduleAppointment()">
        <div class="btn-icon">
          <i class="fas fa-plus"></i>
        </div>
        <span>Agendar Turno</span>
        <div class="btn-shine"></div>
      </button>
    </div>

    <!-- Filtros Mejorados -->
    <div class="filter-container">
      <div class="filter-tabs">
        <button
          class="filter-tab"
          [class.active]="currentFilter === 'pending'"
          (click)="setFilter('pending')"
        >
          <div class="tab-icon">
            <i class="fas fa-clock"></i>
          </div>
          <div class="tab-content">
            <span class="tab-label">Pendientes</span>
            <span class="tab-count" *ngIf="getFilterCount('pending') > 0">{{
              getFilterCount("pending")
            }}</span>
          </div>
          <div class="tab-indicator"></div>
        </button>
        <button
          class="filter-tab"
          [class.active]="currentFilter === 'upcoming'"
          (click)="setFilter('upcoming')"
        >
          <div class="tab-icon">
            <i class="fas fa-calendar"></i>
          </div>
          <div class="tab-content">
            <span class="tab-label">Próximos</span>
            <span class="tab-count" *ngIf="getFilterCount('upcoming') > 0">{{
              getFilterCount("upcoming")
            }}</span>
          </div>
          <div class="tab-indicator"></div>
        </button>
        <button
          class="filter-tab"
          [class.active]="currentFilter === 'past'"
          (click)="setFilter('past')"
        >
          <div class="tab-icon">
            <i class="fas fa-history"></i>
          </div>
          <div class="tab-content">
            <span class="tab-label">Pasados</span>
            <span class="tab-count" *ngIf="getFilterCount('past') > 0">{{
              getFilterCount("past")
            }}</span>
          </div>
          <div class="tab-indicator"></div>
        </button>
        <button
          class="filter-tab"
          [class.active]="currentFilter === 'all'"
          (click)="setFilter('all')"
        >
          <div class="tab-icon">
            <i class="fas fa-list"></i>
          </div>
          <div class="tab-content">
            <span class="tab-label">Todos</span>
            <span class="tab-count">{{ allTurnos.length }}</span>
          </div>
          <div class="tab-indicator"></div>
        </button>
      </div>
    </div>

    <!-- Búsqueda Rápida -->
    <div class="search-container">
      <input
        type="text"
        class="search-input"
        placeholder="Buscar por paciente, médico, centro o ID..."
        [(ngModel)]="searchQuery"
        (input)="applySearch()"
      />
      <i class="fas fa-search search-icon"></i>
    </div>

    <!-- Loading state -->
    <div class="loading-container" *ngIf="isLoadingTurnos">
      <div class="loading-spinner">
        <div class="spinner"></div>
        <p>Cargando turnos...</p>
      </div>
    </div>

    <!-- Appointments grid -->
    <div
      class="appointments-grid"
      *ngIf="!isLoadingTurnos && filteredTurnos.length > 0"
    >
      <div
        class="appointment-card"
        *ngFor="let turno of filteredTurnos; trackBy: trackByTurno"
        [class]="'status-' + turno.status"
      >
        <!-- Card Header -->
        <div class="card-header">
          <div class="date-container">
            <div class="date-circle">
              <span class="day">{{ turno.day }}</span>
              <span class="month">{{ turno.month }}</span>
            </div>
            <div class="year-time">
              <span class="year">{{ turno.year }}</span>
              <span class="time">
                <i class="fas fa-clock me-1"></i>
                {{ turno.time }}
              </span>
            </div>
          </div>

          <div class="status-badge" [class]="'status-' + turno.status">
            <i class="fas" [class]="getStatusIcon(turno.status)"></i>
            <span>{{ getStatusText(turno.status) }}</span>
          </div>
        </div>

        <!-- Card Body -->
        <div class="card-body">
          <div class="patient-section">
            <div class="patient-avatar">
              <i class="fas fa-user"></i>
            </div>
            <div class="patient-info">
              <h4 class="patient-name">{{ turno.patientName }}</h4>
              <!-- <p class="patient-dni">
                    <i class="fas fa-id-card me-1"></i>
                    DNI: {{ turno.patientDNI }}
                  </p> -->
            </div>
          </div>

          <div class="doctor-section">
            <div class="doctor-avatar">
              <i class="fas fa-user-md"></i>
            </div>
            <div class="doctor-info">
              <h4 class="doctor-name">{{ turno.doctor }}</h4>
              <p class="specialty">
                <i class="fas fa-stethoscope me-1"></i>
                {{ turno.specialty }}
              </p>
            </div>
          </div>

          <div class="location-info">
            <i class="fas fa-map-marker-alt me-2"></i>
            <span>{{ turno.location }}</span>
          </div>
        </div>

        <!-- Card Actions -->
        <div class="card-actions" *ngIf="canPerformActions(turno)">
          <button
            class="action-btn confirm-btn"
            *ngIf="canConfirm(turno)"
            (click)="confirmarTurno(turno)"
            title="Confirmar turno"
          >
            <i class="fas fa-check"></i>
            <span>Confirmar</span>
          </button>

          <button
            class="action-btn reschedule-btn"
            *ngIf="canReschedule(turno)"
            (click)="reprogramarTurno(turno)"
            title="Reagendar turno"
          >
            <i class="fas fa-calendar-alt"></i>
            <span>Reagendar</span>
          </button>

          <button
            class="action-btn cancel-btn"
            *ngIf="canCancel(turno)"
            (click)="cancelarTurno(turno)"
            title="Cancelar turno"
          >
            <i class="fas fa-times"></i>
            <span>Cancelar</span>
          </button>

          <button
            class="action-btn view-btn"
            (click)="verDetalle(turno.id)"
            title="Ver detalle"
          >
            <i class="fas fa-eye"></i>
            <span>Ver</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Empty state -->
    <div
      class="empty-state"
      *ngIf="!isLoadingTurnos && filteredTurnos.length === 0"
    >
      <div class="empty-illustration">
        <div class="empty-icon">
          <i class="fas fa-calendar-times"></i>
        </div>
        <div class="empty-content">
          <h3>No hay turnos {{ getEmptyStateText() }}</h3>
          <p>{{ getEmptyStateDescription() }}</p>
          <!-- <button
                class="btn btn-primary btn-lg"
                (click)="scheduleAppointment()"
                *ngIf="currentFilter !== 'past'"
              >
                <i class="fas fa-plus me-2"></i>
                Agendar un turno
              </button> -->
        </div>
      </div>
    </div>
  </div>

  <!-- Modal for Cancel -->
  <div class="modal" *ngIf="showReasonModal">
    <div class="modal-content">
      <span
        class="close"
        (click)="closeModal()"
        [style.display]="isSubmitting ? 'none' : 'block'"
        >&times;</span
      >
      <h2>Cancelar Turno</h2>

      <div *ngIf="selectedTurno" class="turno-info">
        <p>
          <strong>Turno:</strong> {{ selectedTurno.day }}/{{
            selectedTurno.month
          }}
          a las {{ selectedTurno.time }}
        </p>
        <p><strong>Paciente:</strong> {{ selectedTurno.patientName }}</p>
        <p><strong>Médico:</strong> {{ selectedTurno.doctor }}</p>
        <p><strong>Lugar:</strong> {{ selectedTurno.location }}</p>
      </div>

      <p>Por favor, proporciona un motivo para cancelar el turno:</p>
      <textarea
        [(ngModel)]="motivo"
        rows="4"
        placeholder="Escribe tu motivo aquí (mínimo 5 caracteres)..."
        [disabled]="isSubmitting"
        class="form-control"
      ></textarea>
      <small class="text-muted"
        >El motivo es obligatorio y debe tener al menos 5 caracteres</small
      >
      <div *ngIf="motivo && motivo.length < 5" class="text-danger mt-1">
        ⚠️ El motivo debe tener al menos 5 caracteres
      </div>

      <div class="modal-actions">
        <button
          class="btn btn-primary"
          (click)="submitReason()"
          [disabled]="
            !motivo.trim() || motivo.trim().length < 5 || isSubmitting
          "
        >
          <span *ngIf="isSubmitting" class="spinner"></span>
          <i *ngIf="!isSubmitting" class="fas fa-times"></i>
          {{ isSubmitting ? "Procesando..." : "Cancelar Turno" }}
        </button>
        <button
          class="btn btn-secondary"
          (click)="closeModal()"
          [disabled]="isSubmitting"
        >
          <i class="fas fa-arrow-left"></i>
          Volver
        </button>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid px-3 py-4">
  <div
    class="banner-operadores d-flex align-items-center justify-content-between mb-4"
  >
    <div class="title-section d-flex align-items-center">
      <div class="header-icon me-3">
        <i class="fas fa-user-cog"></i>
      </div>
      <div>
        <h1 class="mb-0 fw-bold">Operadores</h1>
        <p class="mb-0 opacity-75">Gestión de operadores del sistema</p>
      </div>
    </div>
    <button class="btn-new" (click)="router.navigate(['/operadores/new'])">
      <i class="fas fa-plus me-2"></i>
      <span class="d-none d-sm-inline">Nuevo Operador</span>
    </button>
  </div>

  <!-- Filtros y búsqueda -->
  <div class="filters-section card mb-4">
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-3">
          <label for="nombreFilter" class="form-label">Buscar por nombre</label>
          <input
            type="text"
            class="form-control"
            id="nombreFilter"
            [(ngModel)]="filters.nombre"
            (input)="onFilterChange()"
            placeholder="Ingrese nombre..."
            autocomplete="off"
          />
        </div>
        <div class="col-md-3">
          <label for="emailFilter" class="form-label">Buscar por email</label>
          <input
            type="text"
            class="form-control"
            id="emailFilter"
            [(ngModel)]="filters.email"
            (input)="onFilterChange()"
            placeholder="Ingrese email..."
            autocomplete="off"
          />
        </div>
        <div class="col-md-2">
          <label for="estadoFilter" class="form-label">Estado</label>
          <select
            class="form-select"
            id="estadoFilter"
            [(ngModel)]="filters.estado"
            (change)="onFilterChange()"
          >
            <option value="">Todos</option>
            <option value="activo">Activo</option>
            <option value="inactivo">Inactivo</option>
          </select>
        </div>
        <div class="col-md-2">
          <label for="pageSizeSelect" class="form-label"
            >Filas por página</label
          >
          <select
            class="form-select"
            id="pageSizeSelect"
            [(ngModel)]="pageSize"
            (change)="onPageSizeChange()"
          >
            <option [value]="5">5 filas</option>
            <option [value]="10">10 filas</option>
            <option [value]="25">25 filas</option>
            <option [value]="50">50 filas</option>
            <option [value]="100">100 filas</option>
          </select>
        </div>
        <div class="col-md-2 d-flex align-items-end">
          <button
            class="btn btn-outline-secondary w-100"
            (click)="clearFilters()"
            [disabled]="!hasActiveFilters()"
          >
            <i class="fas fa-times me-1"></i>
            Limpiar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabla de operadores -->
  <div class="modern-table">
    <table class="table table-hover align-middle mb-0">
      <thead>
        <tr>
          <th class="border-0 py-3 ps-4">ID</th>
          <th
            class="border-0 py-3 sortable-header"
            (click)="onSortChange('nombre')"
            role="button"
            tabindex="0"
            (keydown.enter)="onSortChange('nombre')"
            (keydown.space)="onSortChange('nombre'); $event.preventDefault()"
            aria-label="Ordenar por nombre"
          >
            Nombre
            <i
              class="fas ms-1"
              [class.fa-sort]="sortConfig?.field !== 'nombre'"
              [class.fa-sort-up]="
                sortConfig?.field === 'nombre' &&
                sortConfig?.direction === 'asc'
              "
              [class.fa-sort-down]="
                sortConfig?.field === 'nombre' &&
                sortConfig?.direction === 'desc'
              "
              aria-hidden="true"
            ></i>
          </th>
          <th
            class="border-0 py-3 sortable-header"
            (click)="onSortChange('apellido')"
            role="button"
            tabindex="0"
            (keydown.enter)="onSortChange('apellido')"
            (keydown.space)="onSortChange('apellido'); $event.preventDefault()"
            aria-label="Ordenar por apellido"
          >
            Apellido
            <i
              class="fas ms-1"
              [class.fa-sort]="sortConfig?.field !== 'apellido'"
              [class.fa-sort-up]="
                sortConfig?.field === 'apellido' &&
                sortConfig?.direction === 'asc'
              "
              [class.fa-sort-down]="
                sortConfig?.field === 'apellido' &&
                sortConfig?.direction === 'desc'
              "
              aria-hidden="true"
            ></i>
          </th>
          <th
            class="border-0 py-3 sortable-header"
            (click)="onSortChange('email')"
            role="button"
            tabindex="0"
            (keydown.enter)="onSortChange('email')"
            (keydown.space)="onSortChange('email'); $event.preventDefault()"
            aria-label="Ordenar por email"
          >
            Email
            <i
              class="fas ms-1"
              [class.fa-sort]="sortConfig?.field !== 'email'"
              [class.fa-sort-up]="
                sortConfig?.field === 'email' && sortConfig?.direction === 'asc'
              "
              [class.fa-sort-down]="
                sortConfig?.field === 'email' &&
                sortConfig?.direction === 'desc'
              "
              aria-hidden="true"
            ></i>
          </th>
          <th class="border-0 py-3 text-center">Estado</th>
          <th class="border-0 py-3 text-center">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <!-- Loading state -->
        <tr *ngIf="loading">
          <td colspan="6" class="text-center py-5">
            <div class="d-flex justify-content-center align-items-center">
              <div class="spinner-border spinner-border-sm me-2" role="status">
                <span class="visually-hidden">Cargando...</span>
              </div>
              <span>Cargando operadores...</span>
            </div>
          </td>
        </tr>

        <!-- Data rows -->
        <tr
          *ngFor="let operador of resultsPage.content || []; let i = index"
          (click)="goToDetail(operador.id)"
          class="hover-operators cursor-pointer"
          [attr.aria-label]="
            'Operador ' + operador.nombre + ' ' + operador.apellido
          "
        >
          <td class="ps-4 py-3">{{ operador.id }}</td>
          <td class="py-3">{{ operador.nombre }}</td>
          <td class="py-3">{{ operador.apellido }}</td>
          <td class="py-3">{{ operador.email }}</td>
          <td class="py-3 text-center">
            <span
              [class.active-badge]="operador.activo"
              [class.inactive-badge]="!operador.activo"
              [attr.aria-label]="
                operador.activo ? 'Estado activo' : 'Estado inactivo'
              "
            >
              {{ operador.activo ? "Activo" : "Inactivo" }}
            </span>
          </td>
          <td class="py-3 text-center">
            <div class="d-flex justify-content-center gap-2">
              <button
                (click)="goToEdit(operador.id); $event.stopPropagation()"
                class="btn-action btn-edit"
                title="Editar operador"
                aria-label="Editar operador"
              >
                <i class="fas fa-edit" aria-hidden="true"></i>
              </button>
              <button
                (click)="confirmDelete(operador.id); $event.stopPropagation()"
                class="btn-action btn-delete"
                title="Eliminar operador"
                aria-label="Eliminar operador"
              >
                <i class="fas fa-trash" aria-hidden="true"></i>
              </button>
            </div>
          </td>
        </tr>

        <!-- Empty state -->
        <tr
          *ngIf="
            !loading &&
            (!resultsPage.content || resultsPage.content.length === 0)
          "
        >
          <td colspan="6" class="text-center py-5">
            <div class="empty-state">
              <i
                class="fas fa-user-cog fa-3x text-muted mb-3"
                aria-hidden="true"
              ></i>
              <h5 class="text-muted">No hay operadores registrados</h5>
              <p class="text-muted small">
                {{
                  hasActiveFilters()
                    ? "No se encontraron resultados para los filtros aplicados"
                    : "Comience agregando un nuevo operador al sistema"
                }}
              </p>
              <button
                *ngIf="hasActiveFilters()"
                class="btn btn-outline-primary mt-2"
                (click)="clearFilters()"
              >
                Limpiar filtros
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Paginación -->
  <div class="mt-4" *ngIf="!loading && resultsPage.totalPages > 1">
    <app-pagination
      [totalPages]="resultsPage.totalPages"
      [currentPage]="currentPage"
      (pageChangeRequested)="onPageChangeRequested($event)"
      [number]="resultsPage.number"
      [hidden]="resultsPage.numberOfElements < 1"
    ></app-pagination>
  </div>

  <!-- Información de resultados -->
  <div
    class="mt-3 text-muted small"
    *ngIf="!loading && resultsPage.totalElements > 0"
  >
    Mostrando {{ resultsPage.numberOfElements }} de
    {{ resultsPage.totalElements }} operadores
    <span *ngIf="resultsPage.totalPages > 1">
      (página {{ currentPage }} de {{ resultsPage.totalPages }},
      {{ pageSize }} filas por página)
    </span>
  </div>
</div>

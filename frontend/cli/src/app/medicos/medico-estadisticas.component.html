<div class="container-fluid">
  <!-- Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center">
        <h1 class="h3 mb-0">Mis Estadísticas</h1>
        <button class="btn btn-outline-secondary" (click)="volverAlDashboard()">
          <i class="fas fa-arrow-left me-2"></i>
          Volver al Dashboard
        </button>
      </div>
    </div>
  </div>

  <!-- Período Selector -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h6 class="mb-0">
            <i class="fas fa-calendar-alt me-2"></i>
            Seleccionar Período
          </h6>
        </div>
        <div class="card-body">
          <div class="btn-group" role="group">
            <button
              *ngFor="let periodo of periodosDisponibles"
              type="button"
              class="btn"
              [class.btn-primary]="periodoSeleccionado === periodo.valor"
              [class.btn-outline-primary]="
                periodoSeleccionado !== periodo.valor
              "
              (click)="seleccionarPeriodo(periodo.valor)"
            >
              {{ periodo.nombre }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- KPI Cards -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card bg-primary text-white stats-card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h3 class="mb-1">{{ estadisticasActuales.turnosRealizados }}</h3>
              <p class="mb-0">Turnos Realizados</p>
            </div>
            <i class="fas fa-check-circle fa-3x opacity-50"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-success text-white stats-card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h3 class="mb-1">
                {{ estadisticasActuales.pacientesAtendidos }}
              </h3>
              <p class="mb-0">Pacientes Únicos</p>
            </div>
            <i class="fas fa-users fa-3x opacity-50"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-info text-white stats-card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h3 class="mb-1">{{ estadisticasActuales.horasTrabajadas }}h</h3>
              <p class="mb-0">Horas Trabajadas</p>
            </div>
            <i class="fas fa-clock fa-3x opacity-50"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-warning text-white stats-card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h3 class="mb-1">{{ calcularTasaCancelacion() }}%</h3>
              <p class="mb-0">Tasa Cancelación</p>
            </div>
            <i class="fas fa-times-circle fa-3x opacity-50"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Row -->
  <div class="row mb-4">
    <!-- Evolución Temporal -->
    <div class="col-md-8">
      <div class="card">
        <div class="card-header">
          <h6 class="mb-0">
            <i class="fas fa-chart-line me-2"></i>
            Evolución de Turnos - {{ getPeriodoNombre() }}
          </h6>
        </div>
        <div class="card-body">
          <div class="chart-container">
            <!-- Simulación de gráfico de líneas -->
            <div class="chart-placeholder">
              <div class="chart-bars">
                <div
                  class="chart-bar"
                  *ngFor="let stat of evolutionData"
                  [style.height.%]="
                    (stat.turnosRealizados / getMaxTurnos()) * 100
                  "
                >
                  <div class="bar-value">{{ stat.turnosRealizados }}</div>
                  <div class="bar-label">{{ stat.periodo }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Distribución por Especialidades -->
    <div class="col-md-4">
      <div class="card">
        <div class="card-header">
          <h6 class="mb-0">
            <i class="fas fa-pie-chart me-2"></i>
            Por Especialidad
          </h6>
        </div>
        <div class="card-body">
          <div class="specialty-stats">
            <div class="specialty-item" *ngFor="let esp of especialidadesStats">
              <div
                class="d-flex justify-content-between align-items-center mb-2"
              >
                <span class="specialty-name">{{ esp.especialidad }}</span>
                <span class="specialty-percentage">{{ esp.porcentaje }}%</span>
              </div>
              <div class="progress mb-3">
                <div
                  class="progress-bar bg-primary"
                  [style.width.%]="esp.porcentaje"
                  role="progressbar"
                ></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Detailed Stats -->
  <div class="row mb-4">
    <!-- Rendimiento Mensual -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h6 class="mb-0">
            <i class="fas fa-calendar-check me-2"></i>
            Rendimiento Mensual
          </h6>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-sm">
              <thead>
                <tr>
                  <th>Mes</th>
                  <th>Turnos</th>
                  <th>Pacientes</th>
                  <th>Horas</th>
                  <th>Tasa Éxito</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let stat of rendimientoMensual">
                  <td>{{ stat.periodo }}</td>
                  <td>
                    <span class="badge bg-primary">{{
                      stat.turnosRealizados
                    }}</span>
                  </td>
                  <td>{{ stat.pacientesAtendidos }}</td>
                  <td>{{ stat.horasTrabajadas }}h</td>
                  <td>
                    <span
                      class="badge"
                      [class.bg-success]="calcularTasaExito(stat) >= 90"
                      [class.bg-warning]="
                        calcularTasaExito(stat) >= 70 &&
                        calcularTasaExito(stat) < 90
                      "
                      [class.bg-danger]="calcularTasaExito(stat) < 70"
                    >
                      {{ calcularTasaExito(stat) }}%
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Comparativa -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h6 class="mb-0">
            <i class="fas fa-balance-scale me-2"></i>
            Comparativa vs Período Anterior
          </h6>
        </div>
        <div class="card-body">
          <div class="comparison-stats">
            <div class="comparison-item">
              <div class="comparison-label">Turnos Realizados</div>
              <div class="comparison-values">
                <span class="current-value">{{
                  estadisticasActuales.turnosRealizados
                }}</span>
                <span
                  class="comparison-arrow"
                  [class.text-success]="comparativas.turnosRealizados > 0"
                  [class.text-danger]="comparativas.turnosRealizados < 0"
                >
                  <i
                    class="fas"
                    [class.fa-arrow-up]="comparativas.turnosRealizados > 0"
                    [class.fa-arrow-down]="comparativas.turnosRealizados < 0"
                  ></i>
                  {{ Math.abs(comparativas.turnosRealizados) }}%
                </span>
              </div>
            </div>

            <div class="comparison-item">
              <div class="comparison-label">Pacientes Atendidos</div>
              <div class="comparison-values">
                <span class="current-value">{{
                  estadisticasActuales.pacientesAtendidos
                }}</span>
                <span
                  class="comparison-arrow"
                  [class.text-success]="comparativas.pacientesAtendidos > 0"
                  [class.text-danger]="comparativas.pacientesAtendidos < 0"
                >
                  <i
                    class="fas"
                    [class.fa-arrow-up]="comparativas.pacientesAtendidos > 0"
                    [class.fa-arrow-down]="comparativas.pacientesAtendidos < 0"
                  ></i>
                  {{ Math.abs(comparativas.pacientesAtendidos) }}%
                </span>
              </div>
            </div>

            <div class="comparison-item">
              <div class="comparison-label">Horas Trabajadas</div>
              <div class="comparison-values">
                <span class="current-value"
                  >{{ estadisticasActuales.horasTrabajadas }}h</span
                >
                <span
                  class="comparison-arrow"
                  [class.text-success]="comparativas.horasTrabajadas > 0"
                  [class.text-danger]="comparativas.horasTrabajadas < 0"
                >
                  <i
                    class="fas"
                    [class.fa-arrow-up]="comparativas.horasTrabajadas > 0"
                    [class.fa-arrow-down]="comparativas.horasTrabajadas < 0"
                  ></i>
                  {{ Math.abs(comparativas.horasTrabajadas) }}%
                </span>
              </div>
            </div>

            <div class="comparison-item">
              <div class="comparison-label">Tasa de Cancelación</div>
              <div class="comparison-values">
                <span class="current-value"
                  >{{ calcularTasaCancelacion() }}%</span
                >
                <span
                  class="comparison-arrow"
                  [class.text-danger]="comparativas.tasaCancelacion > 0"
                  [class.text-success]="comparativas.tasaCancelacion < 0"
                >
                  <i
                    class="fas"
                    [class.fa-arrow-up]="comparativas.tasaCancelacion > 0"
                    [class.fa-arrow-down]="comparativas.tasaCancelacion < 0"
                  ></i>
                  {{ Math.abs(comparativas.tasaCancelacion) }}%
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Export Actions -->
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h6 class="mb-0">
            <i class="fas fa-download me-2"></i>
            Exportar Estadísticas
          </h6>
        </div>
        <div class="card-body">
          <div class="d-flex gap-2 flex-wrap">
            <button class="btn btn-outline-success" (click)="exportarExcel()">
              <i class="fas fa-file-excel me-2"></i>
              Exportar Excel
            </button>
            <button class="btn btn-outline-danger" (click)="exportarPDF()">
              <i class="fas fa-file-pdf me-2"></i>
              Reporte PDF
            </button>
            <button class="btn btn-outline-primary" (click)="enviarPorEmail()">
              <i class="fas fa-envelope me-2"></i>
              Enviar por Email
            </button>
            <button class="btn btn-outline-info" (click)="programarReporte()">
              <i class="fas fa-clock me-2"></i>
              Programar Reporte
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

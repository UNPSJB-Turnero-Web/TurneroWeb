<div class="container mt-4" *ngIf="medico">
  <div class="card modern-card">
    <!-- HEADER MODERNO -->
    <div class="card-header">
      <div class="header-content">
        <div class="header-icon">
          <i class="fas fa-user-md"></i>
        </div>
        <div class="header-text">
          <h1>{{ esNuevo ? "Nuevo M√©dico" : "M√©dico #" + medico.id }}</h1>
          <p>
            {{
              esNuevo
                ? "Registre un nuevo profesional m√©dico"
                : medico.nombre + " " + medico.apellido
            }}
          </p>
        </div>
      </div>
    </div>

    <!-- BODY DEL CARD -->
    <div class="card-body">
      <!-- MODO VISTA -->
      <div *ngIf="!modoEdicion">
        <div class="info-grid">
          <div class="info-item">
            <div class="info-label">
              <span
                class="info-icon"
                style="
                  background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
                "
                >üÜî</span
              >
              ID del M√©dico
            </div>
            <div class="info-value">
              {{ medico.id }}
            </div>
          </div>

          <div class="info-item">
            <div class="info-label">
              <span
                class="info-icon"
                style="
                  background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
                "
                >üë®‚Äç‚öïÔ∏è</span
              >
              Nombre Completo
            </div>
            <div class="info-value">
              {{ medico.nombre }} {{ medico.apellido }}
            </div>
          </div>

          <div class="info-item">
            <div class="info-label">
              <span
                class="info-icon"
                style="
                  background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
                "
                >ü™™</span
              >
              DNI
            </div>
            <div class="info-value">
              {{ medico.dni }}
            </div>
          </div>

          <div class="info-item">
            <div class="info-label">
              <span
                class="info-icon"
                style="
                  background: linear-gradient(135deg, #fd7e14 0%, #e8630a 100%);
                "
                >üèÖ</span
              >
              Matr√≠cula
            </div>
            <div class="info-value">
              {{ medico.matricula }}
            </div>
          </div>

          <div class="info-item">
            <div class="info-label">
              <span
                class="info-icon"
                style="
                  background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
                "
                >üìß</span
              >
              Email
            </div>
            <div class="info-value">
              {{ medico.email }}
            </div>
          </div>

          <div class="info-item">
            <div class="info-label">
              <span
                class="info-icon"
                style="
                  background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
                "
                >üìû</span
              >
              Tel√©fono
            </div>
            <div class="info-value">
              {{ medico.telefono }}
            </div>
          </div>

          <div class="info-item">
            <div class="info-label">
              <span
                class="info-icon"
                style="
                  background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%);
                "
                >üè•</span
              >
              Especialidades
            </div>
            <div class="info-value">
              <div
                *ngIf="
                  medico.especialidades && medico.especialidades.length > 0;
                  else noEspecialidades
                "
                class="especialidades-container"
              >
                <span
                  *ngFor="let esp of medico.especialidades; let last = last"
                  class="especialidad-badge"
                >
                  {{ esp.nombre }}<span *ngIf="!last">, </span>
                </span>
              </div>
              <ng-template #noEspecialidades>
                <span class="text-muted">Sin especialidades asignadas</span>
              </ng-template>
            </div>
          </div>
        </div>
      </div>

      <!-- MODO EDICI√ìN -->
      <form *ngIf="modoEdicion" #form="ngForm" (ngSubmit)="save()">
        <div class="row">
          <!-- Nombre -->
          <div class="col-md-6">
            <div class="form-group-modern">
              <label class="form-label-modern">
                <span
                  class="form-icon"
                  style="
                    background: linear-gradient(
                      135deg,
                      #28a745 0%,
                      #20c997 100%
                    );
                  "
                  >üë®‚Äç‚öïÔ∏è</span
                >
                Nombre
              </label>
              <input
                [(ngModel)]="medico.nombre"
                name="nombre"
                class="form-control form-control-modern"
                placeholder="Nombre del m√©dico"
                required
                #nombre="ngModel"
              />
              <div
                *ngIf="nombre.invalid && (nombre.dirty || nombre.touched)"
                class="form-help text-danger"
              >
                El nombre es requerido
              </div>
            </div>
          </div>

          <!-- Apellido -->
          <div class="col-md-6">
            <div class="form-group-modern">
              <label class="form-label-modern">
                <span
                  class="form-icon"
                  style="
                    background: linear-gradient(
                      135deg,
                      #28a745 0%,
                      #20c997 100%
                    );
                  "
                  >üë®‚Äç‚öïÔ∏è</span
                >
                Apellido
              </label>
              <input
                [(ngModel)]="medico.apellido"
                name="apellido"
                class="form-control form-control-modern"
                placeholder="Apellido del m√©dico"
                required
                #apellido="ngModel"
              />
              <div
                *ngIf="apellido.invalid && (apellido.dirty || apellido.touched)"
                class="form-help text-danger"
              >
                El apellido es requerido
              </div>
            </div>
          </div>

          <!-- DNI -->
          <div class="col-md-6">
            <div class="form-group-modern">
              <label class="form-label-modern">
                <span
                  class="form-icon"
                  style="
                    background: linear-gradient(
                      135deg,
                      #17a2b8 0%,
                      #138496 100%
                    );
                  "
                  >ü™™</span
                >
                DNI
              </label>
              <input
                [(ngModel)]="medico.dni"
                name="dni"
                class="form-control form-control-modern"
                placeholder="Documento Nacional de Identidad"
                required
                #dni="ngModel"
              />
              <div
                *ngIf="dni.invalid && (dni.dirty || dni.touched)"
                class="form-help text-danger"
              >
                El DNI es requerido
              </div>
              <div class="form-help">
                Ingrese el n√∫mero de DNI sin puntos ni espacios.
              </div>
            </div>
          </div>

          <!-- Matr√≠cula -->
          <div class="col-md-6">
            <div class="form-group-modern">
              <label class="form-label-modern">
                <span
                  class="form-icon"
                  style="
                    background: linear-gradient(
                      135deg,
                      #fd7e14 0%,
                      #e8630a 100%
                    );
                  "
                  >üèÖ</span
                >
                Matr√≠cula
              </label>
              <input
                [(ngModel)]="medico.matricula"
                name="matricula"
                class="form-control form-control-modern"
                placeholder="N√∫mero de matr√≠cula profesional"
                required
                #matricula="ngModel"
              />
              <div
                *ngIf="
                  matricula.invalid && (matricula.dirty || matricula.touched)
                "
                class="form-help text-danger"
              >
                La matr√≠cula es requerida
              </div>
              <div class="form-help">
                Ingrese el n√∫mero de matr√≠cula profesional del m√©dico.
              </div>
            </div>
          </div>

          <!-- Email -->
          <div class="col-md-6">
            <div class="form-group-modern">
              <label class="form-label-modern">
                <span
                  class="form-icon"
                  style="
                    background: linear-gradient(
                      135deg,
                      #dc3545 0%,
                      #c82333 100%
                    );
                  "
                  >üìß</span
                >
                Email
              </label>
              <input
                [(ngModel)]="medico.email"
                name="email"
                type="email"
                class="form-control form-control-modern"
                placeholder="Correo electr√≥nico del m√©dico"
                required
                #email="ngModel"
              />
              <div
                *ngIf="email.invalid && (email.dirty || email.touched)"
                class="form-help text-danger"
              >
                <span *ngIf="email.errors?.['required']"
                  >El email es requerido</span
                >
                <span *ngIf="email.errors?.['email']"
                  >Ingrese un email v√°lido</span
                >
              </div>
              <div class="form-help">
                Correo electr√≥nico de contacto del m√©dico.
              </div>
            </div>
          </div>

          <!-- Tel√©fono -->
          <div class="col-md-6">
            <div class="form-group-modern">
              <label class="form-label-modern">
                <span
                  class="form-icon"
                  style="
                    background: linear-gradient(
                      135deg,
                      #ffc107 0%,
                      #e0a800 100%
                    );
                  "
                  >üìû</span
                >
                Tel√©fono
              </label>
              <input
                [(ngModel)]="medico.telefono"
                name="telefono"
                class="form-control form-control-modern"
                placeholder="Tel√©fono de contacto"
                required
                #telefono="ngModel"
              />
              <div
                *ngIf="telefono.invalid && (telefono.dirty || telefono.touched)"
                class="form-help text-danger"
              >
                El tel√©fono es requerido
              </div>
              <div class="form-help">
                N√∫mero de tel√©fono de contacto del m√©dico.
              </div>
            </div>
          </div>

          <!-- Especialidades -->
          <div class="col-md-12">
            <div class="form-group-modern">
              <label class="form-label-modern">
                <span
                  class="form-icon"
                  style="
                    background: linear-gradient(
                      135deg,
                      #6f42c1 0%,
                      #5a32a3 100%
                    );
                  "
                  >üè•</span
                >
                Especialidades
              </label>

              <!-- Lista de especialidades seleccionadas -->
              <div
                *ngIf="
                  medico.especialidades && medico.especialidades.length > 0
                "
                class="selected-especialidades mb-3"
              >
                <div class="selected-especialidades-header">
                  <small class="text-muted"
                    >Especialidades seleccionadas:</small
                  >
                </div>
                <div class="especialidades-badges">
                  <span
                    *ngFor="let esp of medico.especialidades"
                    class="badge-especialidad"
                  >
                    {{ esp.nombre }}
                    <button
                      type="button"
                      class="btn-remove-especialidad"
                      (click)="removeEspecialidad(esp)"
                    >
                      √ó
                    </button>
                  </span>
                </div>
              </div>

              <!-- Selector para agregar especialidades -->
              <select
                [(ngModel)]="selectedEspecialidad"
                name="selectedEspecialidad"
                class="form-control form-control-modern"
                (change)="addEspecialidad()"
              >
                <option [ngValue]="null">
                  Seleccione una especialidad para agregar...
                </option>
                <option
                  *ngFor="let especialidad of getAvailableEspecialidades()"
                  [ngValue]="especialidad"
                >
                  {{ especialidad.nombre }}
                </option>
              </select>

              <div
                *ngIf="
                  medico.especialidades && medico.especialidades.length === 0
                "
                class="form-help text-warning"
              >
                Debe seleccionar al menos una especialidad
              </div>
              <div class="form-help">
                Seleccione todas las especialidades del m√©dico. Puede agregar
                m√∫ltiples especialidades.
              </div>
            </div>
          </div>

          <!-- Informaci√≥n sobre contrase√±a autom√°tica para nuevos m√©dicos -->
          <div class="col-md-12 mt-2" *ngIf="esNuevo">
            <div
              class="alert alert-info d-flex align-items-center medico-password-alert"
            >
              <i class="fas fa-info-circle me-3"></i>
              <div>
                <strong>Contrase√±a autom√°tica:</strong>
                Se generar√° una contrase√±a segura autom√°ticamente y ser√° enviada
                por correo electr√≥nico al m√©dico.
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>

    <!-- FOOTER DEL CARD -->
    <div class="card-footer">
      <div class="d-flex gap-2 flex-wrap">
        <!-- Botones en modo vista -->
        <ng-container *ngIf="!modoEdicion">
          <button
            type="button"
            class="btn btn-modern btn-back"
            (click)="goBack()"
          >
            ‚Üê Volver
          </button>
          <button
            type="button"
            class="btn btn-modern btn-edit"
            (click)="activarEdicion()"
          >
            ‚úèÔ∏è Editar
          </button>
          <button
            type="button"
            class="btn btn-modern btn-delete ms-auto"
            (click)="remove()"
            *ngIf="medico.id"
          >
            üóëÔ∏è Eliminar
          </button>
        </ng-container>

        <!-- Botones en modo edici√≥n -->
        <ng-container *ngIf="modoEdicion">
          <button
            type="submit"
            class="btn btn-modern btn-save"
            (click)="save()"
          >
            üíæ Guardar
          </button>
          <button
            type="button"
            class="btn btn-modern btn-cancel"
            (click)="cancelar()"
          >
            ‚ùå Cancelar
          </button>
        </ng-container>
      </div>
    </div>
  </div>
</div>

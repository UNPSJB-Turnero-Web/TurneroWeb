<div class="estadisticas-container">
    <!-- Header -->
    <div class="estadisticas-header">
        <div class="header-content">
            <h1 class="page-title">
                <i class="fas fa-chart-line"></i>
                Estadísticas de Lista de Espera
            </h1>
            <p class="page-subtitle">
                Análisis y métricas del sistema de lista de espera
            </p>
        </div>

        <div class="header-actions">
            <button class="btn btn-outline-primary" (click)="cargarEstadisticas()" [disabled]="cargando">
                <i class="fas fa-sync-alt" [class.fa-spin]="cargando"></i>
                Actualizar
            </button>
            <button class="btn btn-outline-secondary" (click)="exportarCSV()">
                <i class="fas fa-file-csv"></i>
                Exportar CSV
            </button>
            <button class="btn btn-outline-info" (click)="imprimirReporte()">
                <i class="fas fa-print"></i>
                Imprimir
            </button>
        </div>
    </div>

    <!-- Filtros -->
    <div class="filtros-card" [formGroup]="filtrosForm">
        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="periodo">Período de Análisis</label>
                    <select class="form-control" id="periodo" formControlName="periodo">
                        <option *ngFor="let periodo of periodos" [value]="periodo.value">
                            {{ periodo.label }}
                        </option>
                    </select>
                </div>
            </div>

            <div class="col-md-6">
                <div class="form-group">
                    <label for="especialidadId">Filtrar por Especialidad (opcional)</label>
                    <select class="form-control" id="especialidadId" formControlName="especialidadId">
                        <option [value]="null">Todas las especialidades</option>
                        <option *ngFor="let esp of especialidades" [value]="esp.id">
                            {{ esp.nombre }}
                        </option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="cargando && !estadisticasGenerales">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Cargando estadísticas...</span>
        </div>
        <p>Cargando estadísticas...</p>
    </div>

    <!-- Error State -->
    <div class="alert alert-danger" *ngIf="error">
        <i class="fas fa-exclamation-triangle"></i>
        {{ error }}
    </div>

    <!-- Estadísticas -->
    <div *ngIf="estadisticasGenerales && !cargando">

        <!-- Cards de Métricas Principales -->
        <div class="metrics-grid">
            <div class="metric-card metric-total">
                <div class="metric-icon">
                    <i class="fas fa-list"></i>
                </div>
                <div class="metric-content">
                    <span class="metric-label">Total de Solicitudes</span>
                    <span class="metric-value">{{ formatearNumero(estadisticasGenerales.totalSolicitudes) }}</span>
                </div>
            </div>

            <div class="metric-card metric-pendientes">
                <div class="metric-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="metric-content">
                    <span class="metric-label">Solicitudes Pendientes</span>
                    <span class="metric-value">{{ formatearNumero(estadisticasGenerales.pendientes) }}</span>
                </div>
            </div>

            <div class="metric-card metric-urgentes">
                <div class="metric-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="metric-content">
                    <span class="metric-label">Casos Urgentes</span>
                    <span class="metric-value">{{ formatearNumero(estadisticasGenerales.urgentes) }}</span>
                    <span class="metric-badge badge-danger" *ngIf="estadisticasGenerales.urgentes > 0">
                        Alta prioridad
                    </span>
                </div>
            </div>

            <div class="metric-card metric-promedio">
                <div class="metric-icon">
                    <i class="fas fa-hourglass-half"></i>
                </div>
                <div class="metric-content">
                    <span class="metric-label">Tiempo Promedio de Espera</span>
                    <span class="metric-value">
                        {{ formatearDias(estadisticasGenerales.tiempoPromedioEsperaDias) }}
                    </span>
                </div>
            </div>
        </div>

        <!-- Distribución por Nivel de Urgencia -->
        <div class="stats-section">
            <h2 class="section-title">
                <i class="fas fa-chart-pie"></i>
                Distribución por Nivel de Urgencia
            </h2>

            <div class="urgencia-grid">
                <div *ngFor="let nivel of nivelesUrgencia" class="urgencia-card"
                    [style.border-left-color]="nivel.color">

                    <div class="urgencia-header">
                        <div class="urgencia-icon" [style.color]="nivel.color">
                            <i class="fas" [class]="nivel.icon"></i>
                        </div>
                        <span class="urgencia-label">{{ nivel.label }}</span>
                    </div>

                    <div class="urgencia-stats">
                        <span class="urgencia-cantidad">
                            {{ formatearNumero(getCantidadPorNivel(nivel.value)) }}
                        </span>
                        <span class="urgencia-porcentaje">
                            {{ getPorcentajeUrgencia(nivel.value).toFixed(1) }}%
                        </span>
                    </div>

                    <div class="urgencia-bar">
                        <div class="urgencia-bar-fill" [style.width.%]="getPorcentajeUrgencia(nivel.value)"
                            [style.background-color]="nivel.color">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ranking de Especialidades con Mayor Demanda -->
        <div class="stats-section">
            <h2 class="section-title">
                <i class="fas fa-trophy"></i>
                Ranking de Especialidades con Mayor Demanda
            </h2>

            <div class="ranking-container" *ngIf="rankingEspecialidades.length > 0">
                <div *ngFor="let item of rankingEspecialidades; let i = index" class="ranking-item"
                    [class.ranking-top]="i < 3">

                    <div class="ranking-position">
                        <span class="position-number" [class.top-three]="i < 3">
                            {{ i + 1 }}
                        </span>
                        <i class="fas fa-medal" *ngIf="i === 0" style="color: #ffd700;"></i>
                        <i class="fas fa-medal" *ngIf="i === 1" style="color: #c0c0c0;"></i>
                        <i class="fas fa-medal" *ngIf="i === 2" style="color: #cd7f32;"></i>
                    </div>

                    <div class="ranking-content">
                        <span class="ranking-especialidad">{{ item.especialidad }}</span>
                        <div class="ranking-bar-container">
                            <div class="ranking-bar" [style.width.%]="getAnchoBarraPorcentaje(item.cantidad)">
                            </div>
                        </div>
                    </div>

                    <div class="ranking-cantidad">
                        <span class="cantidad-badge">
                            {{ formatearNumero(item.cantidad) }}
                        </span>
                    </div>
                </div>
            </div>

            <div class="alert alert-info" *ngIf="rankingEspecialidades.length === 0">
                <i class="fas fa-info-circle"></i>
                No hay datos de demanda para el período seleccionado
            </div>
        </div>

    </div>
</div>
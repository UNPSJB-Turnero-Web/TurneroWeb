<div class="card">
  <!-- HEADER DEL CARD -->
  <div class="card-header text-white">
    <div class="d-flex align-items-center">
      <div class="info-icon me-3" style="background: rgba(255,255,255,0.2);">
        üè•
      </div>
      <div>
        <h4 class="mb-0 fw-bold">
          <ng-container *ngIf="!modoEdicion && centroAtencion.id; else nuevoTitle">
            Centro de Atenci√≥n: {{ centroAtencion.nombre }}
          </ng-container>
          <ng-template #nuevoTitle>
            <ng-container *ngIf="!centroAtencion.id || centroAtencion.id === 0; else editando">
              Nuevo Centro de Atenci√≥n
            </ng-container>
            <ng-template #editando>
              Editando: {{ centroAtencion.nombre }}
            </ng-template>
          </ng-template>
        </h4>
        <small class="opacity-75">
          <ng-container *ngIf="!modoEdicion">Informaci√≥n del Centro de Atenci√≥n</ng-container>
          <ng-container *ngIf="modoEdicion && centroAtencion.id">Editando Centro de Atenci√≥n</ng-container>
          <ng-container *ngIf="modoEdicion && (!centroAtencion.id || centroAtencion.id === 0)">Creando Nuevo Centro de Atenci√≥n</ng-container>
        </small>
      </div>
    </div>
  </div>

  <!-- CUERPO DEL CARD -->
  <div class="card-body">
    <!-- MODO VISTA -->
    <div *ngIf="!modoEdicion">
      <div class="row">
        <div class="col-12">
          <div class="info-item d-flex align-items-center">
            <div class="info-icon" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
              üÜî
            </div>
            <div class="flex-grow-1">
              <div class="info-label">C√≥digo del Centro</div>
              <div class="info-value">
                <span class="id-display">{{ centroAtencion.code || 'No asignado' }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="col-12">
          <div class="info-item d-flex align-items-center">
            <div class="info-icon" style="background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);">
              üìç
            </div>
            <div class="flex-grow-1">
              <div class="info-label">Direcci√≥n</div>
              <div class="info-value">
                <span class="centro-display">{{ centroAtencion.direccion || 'No especificada' }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="col-12">
          <div class="info-item d-flex align-items-center">
            <div class="info-icon" style="background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%);">
              üèôÔ∏è
            </div>
            <div class="flex-grow-1">
              <div class="info-label">Localidad</div>
              <div class="info-value">
                <span class="localidad-display">{{ centroAtencion.localidad || 'No especificada' }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="col-12">
          <div class="info-item d-flex align-items-center">
            <div class="info-icon" style="background: linear-gradient(135deg, #fd7e14 0%, #e8630a 100%);">
              üó∫Ô∏è
            </div>
            <div class="flex-grow-1">
              <div class="info-label">Provincia</div>
              <div class="info-value">
                <span class="provincia-display">{{ centroAtencion.provincia || 'No especificada' }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="col-12">
          <div class="info-item d-flex align-items-center">
            <div class="info-icon" style="background: linear-gradient(135deg, #20c997 0%, #17a2b8 100%);">
              üìû
            </div>
            <div class="flex-grow-1">
              <div class="info-label">Tel√©fono</div>
              <div class="info-value">
                <span class="telefono-display">{{ centroAtencion.telefono || 'No registrado' }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="col-12">
          <div class="info-item d-flex align-items-center">
            <div class="info-icon" style="background: linear-gradient(135deg, #e83e8c 0%, #d91a72 100%);">
              üåç
            </div>
            <div class="flex-grow-1">
              <div class="info-label">Coordenadas GPS</div>
              <div class="info-value">
                <span class="coordenadas-display">{{ centroAtencion.latitud }}, {{ centroAtencion.longitud }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- MODO EDICI√ìN -->
    <form *ngIf="modoEdicion" (ngSubmit)="onSave()" #centroForm="ngForm">
      <div class="row">
        <div class="col-12">
          <div class="form-group-modern">
            <label class="form-label-modern">
              <span class="form-icon" style="background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);">üè•</span>
              Nombre del Centro
            </label>
            <input
              [(ngModel)]="centroAtencion.nombre"
              name="nombre"
              class="form-control form-control-modern"
              placeholder="Nombre del centro de atenci√≥n"
              required
              #nombre="ngModel"
            >
            <div *ngIf="nombre.invalid && (nombre.dirty || nombre.touched)" class="form-help text-danger">
              El nombre del centro es requerido.
            </div>
            <div class="form-help">
              Ingrese el nombre completo del centro de atenci√≥n m√©dica.
            </div>
          </div>
        </div>

        <div class="col-12">
          <div class="form-group-modern">
            <label class="form-label-modern">
              <span class="form-icon" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">üÜî</span>
              C√≥digo
            </label>
            <input
              [(ngModel)]="centroAtencion.code"
              name="code"
              class="form-control form-control-modern"
              placeholder="C√≥digo del centro (opcional)"
            >
            <div class="form-help">
              El c√≥digo se asigna autom√°ticamente si no se especifica.
            </div>
          </div>
        </div>

        <div class="col-12">
          <div class="form-group-modern">
            <label class="form-label-modern">
              <span class="form-icon" style="background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%);">üìç</span>
              Direcci√≥n
            </label>
            <input
              [(ngModel)]="centroAtencion.direccion"
              name="direccion"
              class="form-control form-control-modern"
              placeholder="Direcci√≥n completa del centro"
              required
              #direccion="ngModel"
            >
            <div *ngIf="direccion.invalid && (direccion.dirty || direccion.touched)" class="form-help text-danger">
              La direcci√≥n es requerida.
            </div>
            <div class="form-help">
              Ingrese la direcci√≥n completa donde se ubica el centro.
            </div>
          </div>
        </div>

        <div class="col-12">
          <div class="form-group-modern">
            <label class="form-label-modern">
              <span class="form-icon" style="background: linear-gradient(135deg, #fd7e14 0%, #e8630a 100%);">üèôÔ∏è</span>
              Localidad
            </label>
            <input
              [(ngModel)]="centroAtencion.localidad"
              name="localidad"
              class="form-control form-control-modern"
              placeholder="Localidad donde se encuentra"
              required
              #localidad="ngModel"
            >
            <div *ngIf="localidad.invalid && (localidad.dirty || localidad.touched)" class="form-help text-danger">
              La localidad es requerida.
            </div>
            <div class="form-help">
              Especifique la localidad del centro de atenci√≥n.
            </div>
          </div>
        </div>

        <div class="col-12">
          <div class="form-group-modern">
            <label class="form-label-modern">
              <span class="form-icon" style="background: linear-gradient(135deg, #e83e8c 0%, #d91a72 100%);">üó∫Ô∏è</span>
              Provincia
            </label>
            <input
              [(ngModel)]="centroAtencion.provincia"
              name="provincia"
              class="form-control form-control-modern"
              placeholder="Provincia"
              required
              #provincia="ngModel"
            >
            <div *ngIf="provincia.invalid && (provincia.dirty || provincia.touched)" class="form-help text-danger">
              La provincia es requerida.
            </div>
            <div class="form-help">
              Indique la provincia donde se ubica el centro.
            </div>
          </div>
        </div>

        <div class="col-12">
          <div class="form-group-modern">
            <label class="form-label-modern">
              <span class="form-icon" style="background: linear-gradient(135deg, #20c997 0%, #17a2b8 100%);">üìû</span>
              Tel√©fono
            </label>
            <input
              [(ngModel)]="centroAtencion.telefono"
              name="telefono"
              class="form-control form-control-modern"
              placeholder="N√∫mero de tel√©fono"
              pattern="^[0-9]*$"
              required
              #telefono="ngModel"
            >
            <div *ngIf="telefono.invalid && (telefono.dirty || telefono.touched)" class="form-help text-danger">
              <div *ngIf="telefono.errors?.['pattern']">Solo se permiten n√∫meros.</div>
              <div *ngIf="telefono.errors?.['required']">El tel√©fono es requerido.</div>
            </div>
            <div class="form-help">
              N√∫mero de contacto del centro (solo n√∫meros).
            </div>
          </div>
        </div>

        <div class="col-12">
          <div class="form-group-modern">
            <label class="form-label-modern">
              <span class="form-icon" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);">üåç</span>
              Coordenadas GPS
            </label>
            <input
              [(ngModel)]="coordenadas"
              name="coordenadas"
              class="form-control form-control-modern"
              placeholder="latitud,longitud (ej: -34.6037,-58.3816)"
            >
            <div class="form-help">
              Formato: latitud,longitud o use el bot√≥n para marcar en el mapa.
            </div>
            <button type="button" class="btn btn-modern btn-secondary mt-2" (click)="onToggleMap()">
              <i class="fa fa-map-marker me-2"></i> Marcar en Mapa
            </button>
          </div>
        </div>
      </div>

      <!-- Map Container -->
      <div *ngIf="showMap" class="mt-4">
        <div class="map-container">
          <div id="map" style="height: 400px; width: 100%;"></div>
        </div>
        <div class="mt-3">
          <input [(ngModel)]="searchQuery" name="searchQuery" placeholder="Buscar ubicaci√≥n..." 
                 class="form-control form-control-modern me-2" style="display: inline-block; width: auto;">
          <button type="button" class="btn btn-modern btn-success" (click)="onSearchLocation()">
            <i class="fa fa-search me-2"></i> Buscar
          </button>
        </div>
      </div>
    </form>
  </div>

  <!-- FOOTER DEL CARD -->
  <div class="card-footer">
    <div class="d-flex gap-2 flex-wrap">
      <!-- Botones en modo vista -->
      <ng-container *ngIf="!modoEdicion">
        <button type="button" class="btn btn-modern btn-back" (click)="onGoBack()">
          ‚Üê Volver
        </button>
        <button type="button" class="btn btn-modern btn-edit" (click)="onActivarEdicion()">
          ‚úèÔ∏è Editar
        </button>
        <button 
          type="button" 
          class="btn btn-modern btn-delete ms-auto" 
          (click)="onConfirmDelete(centroAtencion)"
          *ngIf="centroAtencion.id"
        >
          üóëÔ∏è Eliminar
        </button>
      </ng-container>

      <!-- Botones en modo edici√≥n -->
      <ng-container *ngIf="modoEdicion">
        <button 
          type="submit" 
          class="btn btn-modern btn-save" 
          [disabled]="onAllFieldsEmpty()"
          (click)="onSave()"
        >
          üíæ Guardar
        </button>
        <button type="button" class="btn btn-modern btn-cancel" (click)="onCancelar()">
          ‚ùå Cancelar
        </button>
      </ng-container>
    </div>
  </div>
</div>

<!-- Map Modal Component -->
<app-map-modal *ngIf="showMap" 
               (locationSelected)="onLocationSelected($event)">
</app-map-modal>

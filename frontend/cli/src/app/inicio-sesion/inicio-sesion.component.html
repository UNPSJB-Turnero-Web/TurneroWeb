<div class="home-container" [@fadeIn]>
  <!-- Hero Section -->
  <div class="hero-section" [@slideUp]>
    <div class="brand-logo" [@logoWave]>
      <i class="fas fa-calendar-check"></i>
      <h1 class="brand-title">CheTurno</h1>
    </div>
  </div>

  <!-- Login Section -->
  <div class="login-section">
    <div class="login-card" [@slideUp]>
      <!-- Register Link -->
      <div class="register-link">
        <p>
          ¿Nuevo en CheTurno?
          <a class="register-redirect" 
             [@pulse]="pulseState" 
             (click)="navigateToRegister()">Crear cuenta</a>
        </p>
      </div>
      
      <form class="login-form" #loginForm="ngForm" (ngSubmit)="handleSubmit(loginForm)" autocomplete="off" novalidate>
        
        <!-- PASO 1: Ingreso de Email -->
        <div *ngIf="currentStep === 'email'" class="login-step">
          <div class="form-title">Inicia sesión en tu cuenta</div>
          
          <!-- Mensaje de error general -->
          <div class="error-message" [class.show]="showEmailError">
            No encontramos una cuenta con ese email.
          </div>

          <div class="form-group">
            <label for="email">E-Mail</label>
            <input
              type="email"
              id="email"
              name="email"
              class="form-control"
              [(ngModel)]="loginData.email"
              required
              pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
              placeholder="tu@email.com"
              title="Ingresa un email válido"
              #email="ngModel"
              (input)="clearEmailErrors()"
            />
            <small class="form-text text-danger" *ngIf="email.invalid && email.touched">
              Ingresa un email válido
            </small>
          </div>

          <div class="remember-me-section">
            <div class="remember-me">
              <input 
                type="checkbox" 
                id="rememberMe" 
                name="rememberMe" 
                [(ngModel)]="loginData.rememberMe"
              />
              <label for="rememberMe">Mantener sesión iniciada</label>
            </div>
          </div>

          <div class="forgot-email-link">
            <a class="forgot-password" (click)="forgotEmail()">
              ¿Olvidaste tu email?
            </a>
          </div>

          <div class="form-actions">
            <button 
              type="submit" 
              class="btn btn-login"
              [disabled]="isLoading || email.invalid"
            >
              <i [class]="isLoading ? 'fas fa-spinner fa-spin' : 'fas fa-arrow-right'"></i>
              {{ isLoading ? 'Verificando...' : 'Continuar' }}
            </button>
          </div>
        </div>

        <!-- PASO 2: Ingreso de Contraseña -->
        <div *ngIf="currentStep === 'password'" class="login-step">
          <div class="form-title">Ingresa tu contraseña</div>
          
          <!-- Información de la cuenta encontrada -->
          <div class="account-info" *ngIf="userAccount">
            <div class="account-content">
              <div class="account-avatar">
                <i class="fas fa-user-circle"></i>
              </div>
              <div class="account-details">
                <div class="account-name">{{ userAccount.name }}</div>
                <div class="account-email">{{ userAccount.email }}</div>
              </div>
            </div>
            <div class="change-account">
              <a (click)="changeAccount()" class="change-account-link">
                <i class="fas fa-exchange-alt"></i>
                Cambiar cuenta
              </a>
            </div>
          </div>

          <!-- Mensaje de error de contraseña -->
          <div class="error-message" [class.show]="showPasswordError">
            Contraseña incorrecta. Por favor, verifica tu contraseña.
          </div>

          <div class="form-group">
            <label for="password">Contraseña</label>
            <div class="password-input-container">
              <input
                [type]="showPassword ? 'text' : 'password'"
                id="password"
                name="password"
                class="form-control password-input"
                [(ngModel)]="loginData.password"
                required
                minlength="8"
                placeholder="Tu contraseña"
                title="Ingresa tu contraseña"
                #password="ngModel"
                (input)="clearPasswordErrors()"
              />
              <button type="button" class="password-toggle" (click)="togglePassword()">
                <i [class]="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
              </button>
            </div>
            <small class="form-text text-danger" *ngIf="password.invalid && password.touched">
              <span *ngIf="password.errors?.['required']">La contraseña es requerida</span>
              <span *ngIf="password.errors?.['minlength']">La contraseña debe tener al menos 8 caracteres</span>
            </small>
          </div>

          <div class="remember-forgot">
            <a class="forgot-password" (click)="forgotPassword()">
              ¿Olvidaste tu contraseña?
            </a>
          </div>

          <div class="form-actions">
            <button 
              type="submit" 
              class="btn btn-login"
              [disabled]="isLoading || password.invalid"
            >
              <i [class]="isLoading ? 'fas fa-spinner fa-spin' : 'fas fa-sign-in-alt'"></i>
              {{ isLoading ? 'Iniciando sesión...' : 'Iniciar Sesión' }}
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
